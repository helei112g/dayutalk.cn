<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="He Lei">
  <!-- Open Graph Data -->
  <meta property="og:title" content="Web开发中说高并发的时候，我们在说什么"/>
  <meta property="og:description" content="" />
  <meta property="og:site_name" content="大愚Talk｜与你把酒言诗"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://dayutalk.cnundefined"/>
  
    <link rel="alternate" href="/atom.xml" title="大愚Talk｜与你把酒言诗" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>大愚Talk｜与你把酒言诗</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-79844617-1', 'auto');
        ga('send', 'pageview');
    </script>


</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">Web开发中说高并发的时候，我们在说什么</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/helei112g">
                  
                  GitHub
                  
                </a>
              </li>
            
              <li>
                <a href="https://juejin.im/user/58c50c75570c35006d632e8e">
                  
                  掘金
                  
                </a>
              </li>
            
              <li>
                <a href="https://segmentfault.com/u/helei112g">
                  
                  SegmentFault
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By He Lei</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2017-08-25</span>
            <span class="time">19:16:25</span>
          </span>
          
          <!--  Categories  -->
            <span class="categories info">Under 

<a href="/categories/高并发/">高并发</a>
</span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/高并发/">#高并发</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <p>概念背后的实质，才值得我们真正去畅谈与思考。<br><a id="more"></a></p>
<p>这并不是一个回答的问题的文章，而是由此引发的一个思考。</p>
<p><strong>大家心里仔细想想，当你们听到高并发网站时，心里对这个网站是个什么概念？首先想到的是淘宝吗？带着问题，我们一起思考技术</strong></p>
<p>写这个话题是因为我对搜索引擎给我的答案很不满意，然后决定把思考的一些东西分享出来，希望可以大家彼此讨论下。</p>
<p>我们经常在面试的时候，被问到有没有高并发的经验？先不说哪些考高并发的公司（我觉得很多时候是面试官想装逼）。我思考的是什么才算是高并发？你一天几个pv肯定高不了。首先在网上查找一下，并未找到明确的标准定义。那么什么是并发呢？</p>
<blockquote>
<p>并发，在操作系统中，是指一个时间段中有几个程序都处于已启动运行到运行完毕之间，且这几个程序都是在同一个处理机上运行，但任一个时刻点上只有一个程序在处理机上运行。</p>
</blockquote>
<p><em>摘自百度百科</em></p>
<h1 id="我们说的高并发是什么？"><a href="#我们说的高并发是什么？" class="headerlink" title="我们说的高并发是什么？"></a>我们说的高并发是什么？</h1><p>上面的定义明显不是我们通常所言的并发，在互联网时代，所讲的并发、高并发，通常是指并发访问。也就是在某个时间点，有多少个访问同时到来。</p>
<p>我看到有人给高并发下了类似的定义：</p>
<blockquote>
<p>高并发通常是指我们提供的系统服务能够同时并行处理很多请求。</p>
</blockquote>
<p>来看看这个定义，这里首先把并发给混淆到并行了。关于<a href="https://laike9m.com/blog/huan-zai-yi-huo-bing-fa-he-bing-xing,61/" target="_blank" rel="external">并发并行的区别看这里</a>，我就不多说，继续探讨并发。</p>
<p>然后定义又说很多请求？什么叫很多请求？做为中国人，这个词让我想象力一发不可收拾……好了，拉回来，继续本文。</p>
<p>那么从上面的分析，可以看出来高并发在网络上业界也没有明确的定义。但根据我搜索情况，一般都是pv在千万级别以上的公司才会涉及到这个概念。所以我得出一个自定义概念：如果某个系统的日pv在千万级别以上，他就可能是一个高并发的系统。</p>
<p>为什么说是可能？那是因为有的公司完全不走技术路线，全靠机器堆，这不在我们的讨论范围。</p>
<h1 id="高并发的问题，我们具体该关心什么？"><a href="#高并发的问题，我们具体该关心什么？" class="headerlink" title="高并发的问题，我们具体该关心什么？"></a>高并发的问题，我们具体该关心什么？</h1><p>讲真话，高并发是个比较抽象的概念。很难有一个统一的可衡量的标准。哪么有一些其它维度的标准指标来衡量系统的性能吗？搬出以前计算机课程里边的一些指标来跟大家聊聊。</p>
<p>先声明几个概念，别打瞌睡。</p>
<ul>
<li>QPS（TPS）：每秒钟 request/事务 数量，在互联网领域，指每秒响应请求数（指http请求）；</li>
<li>吞吐量：单位时间内处理的请求数量（通常由QPS与并发数决定）；</li>
<li>响应时间：系统对一个请求做出响应的平均时间。例如系统处理一个HTTP请求需要200ms，这个200ms就是系统的响应时间（我认为这里应该仅包含处理时间，网络传输时间忽略）。</li>
</ul>
<p><strong>这里一定要注意呃，QPS ≠ 并发数</strong></p>
<p>并发是指，某个时刻有多少个访问同时到来。QPS是指秒钟响应的请求数量。那么这里就肯容易推算出一个公式：</p>
<p>QPS = 并发数 / 平均响应时间</p>
<p>后面我们的分析都是围绕这个公示来进行展开，没明白的再回味一下。</p>
<p>现在我们来假设一个场景：既然QPS是每秒钟处理的http请求数量。那么1s = 1000ms。假设我们当前一个http请求服务器处理完成需要100ms（即那么 <strong>平均响应时间 = 100ms </strong>）。那么它1s钟可以处理10个请求。也就是说 <strong>qps = 10</strong>。推算出 <strong>并发数 = 10</strong></p>
<p>常常我们被问到高并发的问题，其实从某种程度上来说是怎么提高现有程序的性能。现在我们基于上面的假设，来进行分析。假设现在有个系统性能上就是我们上面的假设，它每天有 300万pv，运行在单机上（当然经常宕机），按照上面的系统性能数据，给出优化解决方案。</p>
<h1 id="提高并发能力"><a href="#提高并发能力" class="headerlink" title="提高并发能力"></a>提高并发能力</h1><p>通过上面的分析，要提升并发能力，我们就需要提升我们的qps（<em>其实这里并不完全正确，为了说明问题，我们先放弃一部分正确性</em>）</p>
<p>最快速解决方案，就是增加机器。我们根据以上情况来实际计算一下。</p>
<ul>
<li>访问量：200w pv</li>
<li>QPS：10</li>
</ul>
<p>根据日常经验，80% 的访问量集中在 20%的时间，算一下这 200w pv实际需要机器达到多少qps才能满足。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qps = (200w * 0.8) / (24 * 3600 * 0.3)</span><br><span class="line"></span><br><span class="line">qps = 61.7</span><br></pre></td></tr></table></figure>
<p>实际上如果在单机上，要求我们每秒钟处理请求必须达到 61.7 以上才行，而实际上我们当前系统的qps是 <code>10</code>。那么怎么解决？</p>
<p><strong>方案一：上机器</strong></p>
<p>个人的能力是有限的，团队的力量是无穷的。既然一台机器搞不定，我们就多上几台机器。这就涉及到db主从、读写分离、负载均衡等技术。</p>
<p>它的原理就是分流，把以前集中的压力分散开来。改方案见效快，灵活，实践起来也更快。</p>
<p><strong>方案二：增加单机性能</strong></p>
<p>单机到底性能能够增加到一个什么程度，这取决于你的机器配置，也取决于你的服务到底有多复杂。</p>
<blockquote>
<p>ps： 写到这里突然有点能够理解为什网上对高并发都是讲很多请求，没有具体数据了，因为这真的只能针对业务来讲，100个并发对静态网页来说根本没有的事儿，但是对于某些密集计算型的估计…</p>
</blockquote>
<p>那么常见的单机如何提升性能？比如：增加不常变化数据的缓存，开启php的opcache，优化代码（如：n+1问题、多重嵌套循环、深层递归等），db表优化等等。由于这些每一个点拿出来都够写一本书了。咋就不继续下去。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>由于笔者自己也是没有实际经历过kw级别pv场景，很多东西讲的不一定对，本文也是理清自己的一点思路。希望能够与更多朋友进行讨论。</p>
<p>也希望本文能够解决你的一点疑惑，让我们能够从高大上的概念落实到实际问题中去。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="https://laike9m.com/blog/huan-zai-yi-huo-bing-fa-he-bing-xing,61/" target="_blank" rel="external">并发和并行的区别</a></li>
<li><a href="http://www.ha97.com/5095.html" target="_blank" rel="external">系统性能测试想个概念</a></li>
</ul>

        </div>
      </div>
    </div>
    <!-- 个人信息 -->
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p align="center" style="margin:0;padding:0;"><img src="https://dayutalk.cn/img/mp-qrcode.jpg"></p>
        <p align="center" style="margin:0;padding:0;">个人公众号：<b>dayuTalk</b></p>
        <p align="center" style="margin:0;padding:0;">联系邮箱：dayugog@gmail.com</p>
        <p align="center" style="margin:0;padding:0;">GitHub：<a href="https://github.com/helei112g">https://github.com/helei112g</a></p>
        <p align="center" style="margin:0;padding:0;"><img width="500" src="https://dayutalk.cn/img/pay-qr.jpeg"></p>
        <p align="center" style="margin:0;padding:0;"><b>我写我的，你赏你的</b></p>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
        <p class="copyright text-muted">
          友情链接
          <a target="_blank" href="//tigerb.cn">Tigerb</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

